{
  "version": 3,
  "sources": ["../src/utils.js", "../src/auth.js", "../src/api.js", "../src/admin.js", "../src/storage.js", "../src/session-middleware.js", "../src/theme.js", "../src/public.js", "../src/database.js", "../src/index.js"],
  "sourceRoot": "dist",
  "sourcesContent": ["// \u4F1A\u8BDD\u66F4\u65B0\u7F13\u5B58\uFF0C\u907F\u514D\u9891\u7E41 KV \u5199\u5165\r\nconst sessionUpdateCache = new Map();\r\n\r\nexport async function verifySession(request, env) {\r\n  const cookieHeader = request.headers.get('Cookie');\r\n  if (!cookieHeader) {\r\n    console.log('No cookie header found');\r\n    return false;\r\n  }\r\n\r\n  // \u66F4\u5065\u58EE\u7684 Cookie \u89E3\u6790\r\n  const cookies = {};\r\n  cookieHeader.split(';').forEach(cookie => {\r\n    const [key, ...values] = cookie.trim().split('=');\r\n    if (key && values.length > 0) {\r\n      cookies[key] = values.join('=');\r\n    }\r\n  });\r\n\r\n  const sessionToken = cookies.session;\r\n  if (!sessionToken) {\r\n    console.log('No session token in cookies');\r\n    return false;\r\n  }\r\n\r\n  console.log('Found session token:', sessionToken.substring(0, 8) + '...');\r\n\r\n  // \u68C0\u67E5\u662F\u5426\u9700\u8981\u66F4\u65B0\u4F1A\u8BDD\uFF08\u6BCF30\u5206\u949F\u66F4\u65B0\u4E00\u6B21\uFF09\r\n  const now = Date.now();\r\n  const lastUpdate = sessionUpdateCache.get(sessionToken) || 0;\r\n  const shouldUpdate = now - lastUpdate > 30 * 60 * 1000; // 30\u5206\u949F\r\n\r\n  // \u9A8C\u8BC1\u4F1A\u8BDD\u4EE4\u724C\u7684\u6709\u6548\u6027\r\n  try {\r\n    // \u4ECE KV \u4E2D\u9A8C\u8BC1\u4F1A\u8BDD\u4FE1\u606F\r\n    const sessionData = await env.POSTS_KV.get(`session:${sessionToken}`, 'json');\r\n    if (sessionData && sessionData.username) {\r\n      // \u68C0\u67E5\u7528\u6237\u662F\u5426\u4ECD\u5728\u7BA1\u7406\u5458\u5217\u8868\u4E2D\r\n      const adminUsers = JSON.parse(env.ADMIN_USERS);\r\n      if (adminUsers.includes(sessionData.username)) {\r\n        console.log('Session valid for user:', sessionData.username);\r\n        \r\n        // \u53EA\u6709\u5728\u9700\u8981\u65F6\u624D\u66F4\u65B0 KV\r\n        if (shouldUpdate) {\r\n          console.log('Updating session timestamp');\r\n          sessionUpdateCache.set(sessionToken, now);\r\n          \r\n          try {\r\n            // \u66F4\u65B0 KV \u4E2D\u7684\u4F1A\u8BDD\u6709\u6548\u671F\r\n            await env.POSTS_KV.put(`session:${sessionToken}`, JSON.stringify({\r\n              username: sessionData.username,\r\n              createdAt: sessionData.createdAt,\r\n              lastAccessed: now\r\n            }), {\r\n              expirationTtl: 604800 // 7 \u5929\r\n            });\r\n          } catch (updateError) {\r\n            console.error('Error updating session:', updateError);\r\n          }\r\n        }\r\n        \r\n        return { valid: true, username: sessionData.username, needsCookieUpdate: shouldUpdate };\r\n      } else {\r\n        console.log('User not in admin list:', sessionData.username);\r\n      }\r\n    } else {\r\n      console.log('No session data found or invalid format');\r\n    }\r\n  } catch (error) {\r\n    console.error('Session verification error:', error);\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n// \u7B80\u5355\u7684\u5185\u5B58\u7F13\u5B58\u5B9E\u73B0\r\nconst postCache = {\r\n  data: null,\r\n  timestamp: 0,\r\n  ttl: 5 * 60 * 1000, // 5\u5206\u949F\u7F13\u5B58\r\n};\r\n\r\nexport async function getAllPosts(kv) {\r\n  const now = Date.now();\r\n  \r\n  // \u68C0\u67E5\u7F13\u5B58\u662F\u5426\u6709\u6548\r\n  if (postCache.data && (now - postCache.timestamp) < postCache.ttl) {\r\n    console.log('Returning cached posts, age:', (now - postCache.timestamp) / 1000, 'seconds');\r\n    return postCache.data;\r\n  }\r\n\r\n  console.log('Fetching fresh posts from KV');\r\n  const list = await kv.list({ prefix: 'post:' });\r\n  const posts = [];\r\n\r\n  // \u4F7F\u7528 Promise.all \u5E76\u884C\u83B7\u53D6\u6240\u6709\u6587\u7AE0\u6570\u636E\r\n  const promises = list.keys.map(async key => {\r\n    const postData = await kv.get(key.name, 'json');\r\n    return postData;\r\n  });\r\n\r\n  const results = await Promise.all(promises);\r\n  \r\n  // \u8FC7\u6EE4\u6389 null \u503C\u5E76\u6DFB\u52A0\u5230\u6570\u7EC4\r\n  results.forEach(postData => {\r\n    if (postData) {\r\n      posts.push(postData);\r\n    }\r\n  });\r\n\r\n  posts.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n  \r\n  // \u66F4\u65B0\u7F13\u5B58\r\n  postCache.data = posts;\r\n  postCache.timestamp = now;\r\n  \r\n  console.log('Fetched', posts.length, 'posts from KV');\r\n  return posts;\r\n}", "export async function handleAuth(request, env, dbWrapper = null) {\r\n  const url = new URL(request.url);\r\n  const path = url.pathname;\r\n\r\n  if (path === '/auth/login') {\r\n    const githubAuthUrl = `https://github.com/login/oauth/authorize?client_id=${env.GITHUB_CLIENT_ID}&scope=user:email`;\r\n    return Response.redirect(githubAuthUrl);\r\n  }\r\n\r\n  if (path === '/auth/callback') {\r\n    const code = url.searchParams.get('code');\r\n    const error = url.searchParams.get('error');\r\n    \r\n    if (error) {\r\n      console.error('GitHub OAuth error:', error);\r\n      return new Response(`GitHub\u6388\u6743\u9519\u8BEF: ${error}`, { status: 400 });\r\n    }\r\n    \r\n    if (!code) {\r\n      return new Response('\u6388\u6743\u5931\u8D25\uFF1A\u672A\u6536\u5230\u6388\u6743\u7801', { status: 400 });\r\n    }\r\n\r\n    try {\r\n      console.log('Getting access token with code:', code);\r\n      \r\n      // \u83B7\u53D6\u8BBF\u95EE\u4EE4\u724C\r\n      const tokenResponse = await fetch('https://github.com/login/oauth/access_token', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Accept': 'application/json',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          client_id: env.GITHUB_CLIENT_ID,\r\n          client_secret: env.GITHUB_CLIENT_SECRET,\r\n          code: code,\r\n        }),\r\n      });\r\n\r\n      const tokenData = await tokenResponse.json();\r\n      console.log('Token response:', tokenData);\r\n      \r\n      if (tokenData.error) {\r\n        console.error('Token error:', tokenData);\r\n        return new Response(`\u83B7\u53D6\u4EE4\u724C\u5931\u8D25: ${tokenData.error_description || tokenData.error}`, { status: 400 });\r\n      }\r\n      \r\n      const accessToken = tokenData.access_token;\r\n      if (!accessToken) {\r\n        return new Response('\u83B7\u53D6\u8BBF\u95EE\u4EE4\u724C\u5931\u8D25', { status: 400 });\r\n      }\r\n\r\n      // \u83B7\u53D6\u7528\u6237\u4FE1\u606F\r\n      const userResponse = await fetch('https://api.github.com/user', {\r\n        headers: {\r\n          'Authorization': `token ${accessToken}`,\r\n          'User-Agent': 'Social-Moments-App',\r\n        },\r\n      });\r\n\r\n      if (!userResponse.ok) {\r\n        console.error('User API error:', userResponse.status, userResponse.statusText);\r\n        return new Response('\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25', { status: 400 });\r\n      }\r\n\r\n      const userData = await userResponse.json();\r\n      console.log('User data:', userData);\r\n      const username = userData.login;\r\n\r\n      // \u68C0\u67E5\u662F\u5426\u4E3A\u7BA1\u7406\u5458\r\n      const adminUsers = JSON.parse(env.ADMIN_USERS);\r\n      console.log('Admin users:', adminUsers, 'Current user:', username);\r\n      \r\n      if (!adminUsers.includes(username)) {\r\n        return new Response(`\u65E0\u6743\u9650\u8BBF\u95EE\u3002\u5F53\u524D\u7528\u6237: ${username}`, { status: 403 });\r\n      }\r\n\r\n      // \u521B\u5EFA\u4F1A\u8BDD\u4EE4\u724C\r\n      const sessionToken = await generateSessionToken(username);\r\n      \r\n      // \u5C06\u4F1A\u8BDD\u4FE1\u606F\u5B58\u50A8\u5230\u6570\u636E\u5E93\u4E2D\r\n      if (dbWrapper) {\r\n        await dbWrapper.adapter.createSession(sessionToken, username);\r\n      } else {\r\n        // \u56DE\u9000\u5230 KV\r\n        await env.POSTS_KV.put(`session:${sessionToken}`, JSON.stringify({\r\n          username: username,\r\n          createdAt: Date.now(),\r\n          lastAccessed: Date.now()\r\n        }), {\r\n          expirationTtl: 604800 // 7 \u5929\u540E\u8FC7\u671F\r\n        });\r\n      }\r\n\r\n      const baseUrl = `${url.protocol}//${url.host}`;\r\n      return new Response(null, {\r\n        status: 302,\r\n        headers: {\r\n          'Location': `${baseUrl}/admin`,\r\n          'Set-Cookie': `session=${sessionToken}; HttpOnly; Secure; SameSite=Lax; Max-Age=604800; Path=/;`\r\n        }\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Auth error:', error);\r\n      return new Response(`\u8BA4\u8BC1\u5931\u8D25: ${error.message}`, { status: 500 });\r\n    }\r\n  }\r\n\r\n  return new Response('\u672A\u627E\u5230', { status: 404 });\r\n}\r\n\r\nasync function generateSessionToken(username) {\r\n  const data = JSON.stringify({ username, timestamp: Date.now() });\r\n  const encoder = new TextEncoder();\r\n  const dataBuffer = encoder.encode(data);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n", "import { getAllPosts } from './utils.js';\r\n\r\nexport async function handleAPI(request, env) {\r\n  const url = new URL(request.url);\r\n  \r\n  if (url.pathname === '/api/posts' && request.method === 'GET') {\r\n    try {\r\n      const posts = await getAllPosts(env.POSTS_KV);\r\n      return new Response(JSON.stringify({ data: posts }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error) {\r\n      return new Response('\u83B7\u53D6\u6570\u636E\u5931\u8D25', { status: 500 });\r\n    }\r\n  }\r\n\r\n  return new Response('\u672A\u627E\u5230', { status: 404 });\r\n}\r\n", "import { getAllPosts } from './utils.js';\nimport { uploadFile, getFileUrl } from './storage.js';\nimport { withSession, createHTMLResponse, createRedirectResponse } from './session-middleware.js';\nimport { getThemeToggleHTML, getThemeToggleScript, getThemeCSS } from './theme.js';\n\nexport async function handleAdmin(request, env, dbWrapper = null) {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // \u4F7F\u7528\u4F1A\u8BDD\u4E2D\u95F4\u4EF6\u5904\u7406\u6240\u6709\u8BF7\u6C42\n  return withSession(request, env, async (request, env, authResult) => {\n    // \u5904\u7406\u9000\u51FA\u767B\u5F55\n    if (path === '/admin/logout') {\n      return await handleLogout(request, env);\n    }\n    \n    // \u5904\u7406\u767B\u5F55\u9875\u9762\n    if (path === '/admin/login') {\n      return createHTMLResponse(getLoginHTML());\n    }\n\n    // \u5904\u7406\u7BA1\u7406\u540E\u53F0\u4E3B\u9875\n    if (path === '/admin' || path === '/admin/') {\n      if (request.method === 'GET') {\n        const posts = dbWrapper ? await dbWrapper.getAllPosts() : await getAllPosts(env.POSTS_KV);\n        return createHTMLResponse(getAdminHTML(posts));\n      }\n\n      if (request.method === 'POST') {\n        return await handleCreatePost(request, env);\n      }\n    }\n\n    // \u5904\u7406\u7F16\u8F91\u9875\u9762\n    if (path.startsWith('/admin/edit/')) {\n      const postId = path.split('/').pop();\n      \n      if (request.method === 'GET') {\n        const postData = dbWrapper ? await dbWrapper.getPost(postId) : await env.POSTS_KV.get(`post:${postId}`, 'json');\n        if (!postData) {\n          return new Response('\u52A8\u6001\u672A\u627E\u5230', { status: 404 });\n        }\n        return createHTMLResponse(getEditHTML(postData));\n      }\n      \n      if (request.method === 'POST') {\n        return await handleUpdatePost(request, env, postId);\n      }\n    }\n\n    // \u5904\u7406\u5220\u9664\u8BF7\u6C42\n    if (path.startsWith('/admin/delete/')) {\n      const postId = path.split('/').pop();\n      \n      if (dbWrapper) {\n        await dbWrapper.deletePost(postId);\n      } else {\n        await env.POSTS_KV.delete(`post:${postId}`);\n      }\n      \n      const baseUrl = `${url.protocol}//${url.host}`;\n      return createRedirectResponse(`${baseUrl}/admin`);\n    }\n\n    return new Response('\u672A\u627E\u5230', { status: 404 });\n  }, false); // \u9000\u51FA\u767B\u5F55\u548C\u767B\u5F55\u9875\u9762\u4E0D\u9700\u8981\u5F3A\u5236\u8BA4\u8BC1\n}\n\nasync function handleLogout(request, env) {\n  const url = new URL(request.url);\n  const cookieHeader = request.headers.get('Cookie');\n  \n  if (cookieHeader) {\n    const cookies = cookieHeader.split(';').reduce((acc, cookie) => {\n      const [key, ...values] = cookie.trim().split('=');\n      if (key && values.length > 0) {\n        acc[key] = values.join('=');\n      }\n      return acc;\n    }, {});\n    \n    const sessionToken = cookies.session;\n    if (sessionToken) {\n      // \u4ECE KV \u4E2D\u5220\u9664\u4F1A\u8BDD\u4FE1\u606F\n      await env.POSTS_KV.delete(`session:${sessionToken}`);\n    }\n  }\n  \n  const baseUrl = `${url.protocol}//${url.host}`;\n  return createRedirectResponse(`${baseUrl}/admin/login`, {\n    'Set-Cookie': 'session=; HttpOnly; Secure; SameSite=Lax; Max-Age=0; Path=/'\n  });\n}\n\n// \u81EA\u52A8\u6E05\u7406\u65E7\u6587\u7AE0\uFF0C\u53EA\u4FDD\u7559\u6700\u65B0\u7684\u6307\u5B9A\u6570\u91CF\nasync function cleanupOldPosts(kv, maxPosts = 20) {\n  try {\n    console.log('Checking post count, max allowed:', maxPosts);\n    \n    // \u83B7\u53D6\u6240\u6709\u6587\u7AE0\u952E\n    const list = await kv.list({ prefix: 'post:' });\n    const allPosts = [];\n    \n    // \u5E76\u884C\u83B7\u53D6\u6240\u6709\u6587\u7AE0\u6570\u636E\n    const promises = list.keys.map(async key => {\n      const postData = await kv.get(key.name, 'json');\n      if (postData) {\n        allPosts.push({ ...postData, key: key.name });\n      }\n    });\n    \n    await Promise.all(promises);\n    \n    // \u6309\u65F6\u95F4\u6392\u5E8F\uFF08\u6700\u65B0\u7684\u5728\u524D\uFF09\n    allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));\n    \n    // \u68C0\u67E5\u662F\u5426\u9700\u8981\u6E05\u7406\n    if (allPosts.length > maxPosts) {\n      const postsToDelete = allPosts.slice(maxPosts);\n      console.log(`Cleaning up ${postsToDelete.length} old posts (keeping ${maxPosts} newest)`);\n      \n      // \u6279\u91CF\u5220\u9664\u65E7\u6587\u7AE0\n      const deletePromises = postsToDelete.map(post => {\n        console.log(`Deleting old post: ${post.id} from ${post.date}`);\n        return kv.delete(post.key);\n      });\n      \n      await Promise.all(deletePromises);\n      console.log(`Successfully deleted ${postsToDelete.length} old posts`);\n    } else {\n      console.log(`Post count (${allPosts.length}) within limit (${maxPosts}), no cleanup needed`);\n    }\n  } catch (error) {\n    console.error('Error cleaning up old posts:', error);\n    // \u4E0D\u5F71\u54CD\u6587\u7AE0\u521B\u5EFA\uFF0C\u53EA\u662F\u8BB0\u5F55\u9519\u8BEF\n  }\n}\n\nasync function handleCreatePost(request, env) {\n  const formData = await request.formData();\n  const content = formData.get('content');\n  const tags = formData.get('tags').split(',').map(tag => tag.trim()).filter(Boolean);\n  const image = formData.get('image');\n\n  const postId = Date.now().toString();\n  const date = new Date().toLocaleString('sv-SE').replace('T', ' ').slice(0, 19);\n\n  let finalContent = content;\n\n  // \u5904\u7406\u56FE\u7247\u4E0A\u4F20\n  if (image && image.size > 0) {\n    console.log('Processing image:', image.name, 'Size:', image.size);\n    \n    try {\n      // \u751F\u6210\u5B89\u5168\u7684\u6587\u4EF6\u540D\n      const imageKey = `${postId}-${image.name.replace(/[^a-zA-Z0-9.-]/g, '_')}`;\n      console.log('Uploading image with key:', imageKey);\n      \n      // \u4E0A\u4F20\u5230\u5B58\u50A8\u670D\u52A1\uFF08R2 \u6216 OSS\uFF09\n      try {\n        await uploadFile({\n          stream: image.stream(),\n          key: imageKey,\n          contentType: image.type || 'image/jpeg'\n        }, env);\n        \n        const imageUrl = await getFileUrl(imageKey, env, request);\n        finalContent = `![${image.name}](${imageUrl})\\n\\n${content}`;\n        console.log('Image uploaded successfully, URL:', imageUrl);\n      } catch (error) {\n        console.error('Image upload failed:', error);\n        // \u7EE7\u7EED\u53D1\u5E03\u6587\u672C\u5185\u5BB9\uFF0C\u5373\u4F7F\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\n      }\n    } catch (error) {\n      console.error('Image upload failed:', error);\n      // \u7EE7\u7EED\u53D1\u5E03\u6587\u672C\u5185\u5BB9\uFF0C\u5373\u4F7F\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\n    }\n  }\n\n  const postData = {\n    id: postId,\n    date: date,\n    tags: tags,\n    content: finalContent\n  };\n\n  // \u5982\u679C\u4F7F\u7528 KV\uFF0C\u81EA\u52A8\u6E05\u7406\u65E7\u6587\u7AE0\uFF08\u53EA\u4FDD\u7559\u6700\u65B0\u768420\u7BC7\uFF09\n  if (!dbWrapper) {\n    await cleanupOldPosts(env.POSTS_KV, 20);\n  }\n\n  if (dbWrapper) {\n    await dbWrapper.createPost(postData);\n  } else {\n    await env.POSTS_KV.put(`post:${postId}`, JSON.stringify(postData));\n  }\n\n  const url = new URL(request.url);\n  const baseUrl = `${url.protocol}//${url.host}`;\n  return createRedirectResponse(`${baseUrl}/admin`);\n}\n\nasync function handleUpdatePost(request, env, postId) {\n  const formData = await request.formData();\n  const content = formData.get('content');\n  const tags = formData.get('tags').split(',').map(tag => tag.trim()).filter(Boolean);\n  const image = formData.get('image');\n\n  // \u83B7\u53D6\u539F\u6709\u6570\u636E\n  const existingPost = dbWrapper ? await dbWrapper.getPost(postId) : await env.POSTS_KV.get(`post:${postId}`, 'json');\n  if (!existingPost) {\n    return new Response('\u52A8\u6001\u672A\u627E\u5230', { status: 404 });\n  }\n\n  let finalContent = content;\n\n  // \u5904\u7406\u65B0\u56FE\u7247\u4E0A\u4F20\n  if (image && image.size > 0) {\n    console.log('Processing new image:', image.name, 'Size:', image.size);\n    \n    try {\n      const imageKey = `${postId}-${image.name.replace(/[^a-zA-Z0-9.-]/g, '_')}`;\n      console.log('Uploading image with key:', imageKey);\n      \n      // \u4E0A\u4F20\u5230\u5B58\u50A8\u670D\u52A1\uFF08R2 \u6216 OSS\uFF09\n      try {\n        await uploadFile({\n          stream: image.stream(),\n          key: imageKey,\n          contentType: image.type || 'image/jpeg'\n        }, env);\n        \n        const imageUrl = await getFileUrl(imageKey, env, request);\n        finalContent = `![${image.name}](${imageUrl})\\n\\n${content}`;\n        console.log('Image uploaded successfully, URL:', imageUrl);\n      } catch (error) {\n        console.error('Image upload failed:', error);\n      }\n    } catch (error) {\n      console.error('Image upload failed:', error);\n    }\n  }\n\n  const updatedPost = {\n    ...existingPost,\n    tags: tags,\n    content: finalContent,\n    updatedAt: new Date().toLocaleString('sv-SE').replace('T', ' ').slice(0, 19)\n  };\n\n  if (dbWrapper) {\n    await dbWrapper.updatePost(postId, updatedPost);\n  } else {\n    await env.POSTS_KV.put(`post:${postId}`, JSON.stringify(updatedPost));\n  }\n  \n  const url = new URL(request.url);\n  const baseUrl = `${url.protocol}//${url.host}`;\n  return createRedirectResponse(`${baseUrl}/admin`);\n}\n\nfunction getLoginHTML() {\n  return `\n<!DOCTYPE html>\n<html>\n<head>\n    <title>\u7BA1\u7406\u5458\u767B\u5F55</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei\", sans-serif;\n            background-color: var(--bg-tertiary);\n            color: var(--text-primary);\n            height: 100vh;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .header { \n            height: 46px;\n            background-color: var(--header-bg);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        \n        .header-title {\n            font-size: 18px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .back-home {\n            position: absolute;\n            left: 15px;\n            color: var(--accent-color);\n            text-decoration: none;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n        \n        .content {\n            flex: 1;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            padding: 20px;\n        }\n        \n        .login-card {\n            background-color: var(--card-bg);\n            border-radius: 10px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n            padding: 25px;\n            width: 100%;\n            max-width: 350px;\n        }\n        \n        .login-header {\n            text-align: center;\n            margin-bottom: 25px;\n        }\n        \n        .login-avatar {\n            width: 60px;\n            height: 60px;\n            background-image: url('https://imgbed.mcyzsx.top/file/avatar/1765626136745_zsxcoder.jpg');\n            background-size: cover;\n            background-position: center;\n            background-repeat: no-repeat;\n            border-radius: 10px;\n            margin: 0 auto 15px;\n        }\n        \n        .login-title {\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 8px;\n            color: var(--text-primary);\n        }\n        \n        .login-subtitle {\n            font-size: 14px;\n            color: var(--text-tertiary);\n            margin-bottom: 20px;\n        }\n        \n        .login-btn {\n            width: 100%;\n            background-color: #07c160;\n            color: white;\n            border: none;\n            border-radius: 5px;\n            font-size: 16px;\n            font-weight: 500;\n            padding: 12px;\n            cursor: pointer;\n            transition: background-color 0.2s;\n            text-decoration: none;\n            display: inline-block;\n            text-align: center;\n            margin-bottom: 15px;\n        }\n        \n        .login-btn:hover {\n            background-color: #06ad56;\n        }\n        \n        .github-btn {\n            background-color: #333;\n            margin-bottom: 15px;\n        }\n        \n        .github-btn:hover {\n            background-color: #24292e;\n        }\n        \n        .login-divider {\n            display: flex;\n            align-items: center;\n            margin: 15px 0;\n            color: #999;\n            font-size: 12px;\n        }\n        \n        .login-divider::before, .login-divider::after {\n            content: '';\n            flex: 1;\n            height: 1px;\n            background-color: #e5e5e5;\n        }\n        \n        .login-divider-text {\n            padding: 0 15px;\n        }\n        \n        .features {\n            margin-top: 15px;\n            background-color: #f8f8f8;\n            border-radius: 5px;\n            padding: 15px;\n        }\n        \n        .features-title {\n            font-size: 14px;\n            font-weight: 500;\n            margin-bottom: 10px;\n            color: var(--text-primary);\n        }\n        \n        .feature-list {\n            display: grid;\n            gap: 8px;\n        }\n        \n        .feature-item {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n        \n        .feature-icon {\n            width: 16px;\n            text-align: center;\n        }\n        \n        .security-note {\n            margin-top: 15px;\n            padding: 10px;\n            background-color: #f0f8ff;\n            border-radius: 5px;\n            border-left: 3px solid #576b95;\n        }\n        \n        .security-note-title {\n            font-size: 13px;\n            font-weight: 500;\n            color: var(--accent-color);\n            margin-bottom: 5px;\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n        \n        .security-note-text {\n            font-size: 12px;\n            color: var(--text-secondary);\n            line-height: 1.4;\n        }\n        \n        ${getThemeCSS()}\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <a href=\"/\" class=\"back-home\">\n            <span>\u2190 \u9996\u9875</span>\n        </a>\n        <div class=\"header-title\">\u7BA1\u7406\u5458\u767B\u5F55</div>\n    </div>\n    \n    <div class=\"content\">\n        <div class=\"login-card\">\n            <div class=\"login-header\">\n                <div class=\"login-avatar\"></div>\n                <div class=\"login-title\">\u7BA1\u7406\u5458\u767B\u5F55</div>\n                <div class=\"login-subtitle\">\u4F7F\u7528\u7B2C\u4E09\u65B9\u8D26\u53F7\u5B89\u5168\u767B\u5F55</div>\n            </div>\n            \n            <a href=\"/auth/login\" class=\"login-btn github-btn\">\n                <span style=\"margin-right: 8px;\">\uD83D\uDC19</span> \u4F7F\u7528 GitHub \u767B\u5F55\n            </a>\n            \n            <div class=\"login-divider\">\n                <div class=\"login-divider-text\">\u6216\u8005</div>\n            </div>\n            \n            <button class=\"login-btn\" disabled>\n                \u5FAE\u4FE1\u767B\u5F55 (\u6682\u672A\u5F00\u653E)\n            </button>\n            \n            <div class=\"features\">\n                <div class=\"features-title\">\u7BA1\u7406\u529F\u80FD</div>\n                <div class=\"feature-list\">\n                    <div class=\"feature-item\">\n                        <span class=\"feature-icon\">\uD83D\uDCDD</span>\n                        <span>\u53D1\u5E03\u548C\u7F16\u8F91\u52A8\u6001\u5185\u5BB9</span>\n                    </div>\n                    <div class=\"feature-item\">\n                        <span class=\"feature-icon\">\uD83D\uDDBC\uFE0F</span>\n                        <span>\u4E0A\u4F20\u548C\u7BA1\u7406\u56FE\u7247</span>\n                    </div>\n                    <div class=\"feature-item\">\n                        <span class=\"feature-icon\">\uD83C\uDFF7\uFE0F</span>\n                        <span>\u6DFB\u52A0\u548C\u7BA1\u7406\u6807\u7B7E</span>\n                    </div>\n                    <div class=\"feature-item\">\n                        <span class=\"feature-icon\">\uD83D\uDCCA</span>\n                        <span>\u67E5\u770B\u6240\u6709\u5DF2\u53D1\u5E03\u5185\u5BB9</span>\n                    </div>\n                    <div class=\"feature-item\">\n                        <span class=\"feature-icon\">\uD83D\uDDD1\uFE0F</span>\n                        <span>\u5220\u9664\u4E0D\u9700\u8981\u7684\u52A8\u6001</span>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"security-note\">\n                <div class=\"security-note-title\">\n                    <span>\uD83D\uDEE1\uFE0F</span>\n                    <span>\u5B89\u5168\u63D0\u793A</span>\n                </div>\n                <div class=\"security-note-text\">\n                    \u53EA\u6709\u6388\u6743\u7684\u7BA1\u7406\u5458\u8D26\u53F7\u624D\u80FD\u8BBF\u95EE\u540E\u53F0\u7BA1\u7406\u529F\u80FD\uFF0C\u767B\u5F55\u8FC7\u7A0B\u901A\u8FC7 GitHub OAuth \u8FDB\u884C\u5B89\u5168\u9A8C\u8BC1\u3002\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    ${getThemeToggleScript()}\n    \n    <!-- \u4E3B\u9898\u5207\u6362\u6309\u94AE -->\n    ${getThemeToggleHTML()}\n</body>\n</html>`;\n}\n\nfunction getAdminHTML(posts) {\n  return `\n<!DOCTYPE html>\n<html>\n<head>\n    <title>\u670B\u53CB\u5708\u7BA1\u7406</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei\", sans-serif;\n            background-color: var(--bg-primary);\n            color: var(--text-primary);\n            font-size: 16px;\n            line-height: 1.5;\n        }\n        \n        .header { \n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 46px;\n            background-color: var(--header-bg);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .header-title {\n            font-size: 18px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .header-buttons { \n            position: fixed;\n            top: 0;\n            right: 10px;\n            height: 46px;\n            display: flex;\n            gap: 10px;\n            align-items: center;\n            z-index: 1001;\n        }\n        \n        .logout-btn, .home-btn { \n            color: var(--accent-color); \n            padding: 6px 12px; \n            text-decoration: none; \n            font-size: 14px;\n            transition: opacity 0.2s;\n        }\n        \n        .logout-btn:hover, .home-btn:hover { \n            opacity: 0.8; \n        }\n        \n        .content {\n            padding-top: 56px;\n            padding-bottom: 20px;\n            background-color: var(--bg-primary);\n        }\n        \n        .admin-container {\n            max-width: 620px;\n            margin: 0 auto;\n            padding: 0 10px;\n        }\n        \n        .compose-box {\n            background-color: var(--card-bg);\n            margin-bottom: 10px;\n            border-radius: 8px;\n            padding: 15px;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n        }\n        \n        .compose-title {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            color: var(--text-primary);\n            text-align: center;\n        }\n        \n        .form-group {\n            margin-bottom: 15px;\n        }\n        \n        .form-group label {\n            display: block;\n            margin-bottom: 5px;\n            color: var(--text-primary);\n            font-size: 14px;\n        }\n        \n        textarea, input[type=\"text\"], input[type=\"file\"] {\n            width: 100%;\n            padding: 10px;\n            border: 1px solid var(--border-color);\n            border-radius: 5px;\n            font-size: 16px;\n            font-family: inherit;\n            background-color: var(--card-bg);\n            color: var(--text-primary);\n        }\n        \n        textarea {\n            height: 80px;\n            resize: vertical;\n            min-height: 80px;\n        }\n        \n        textarea:focus, input:focus {\n            outline: none;\n            border-color: var(--accent-color);\n        }\n        \n        .submit-btn {\n            width: 100%;\n            padding: 10px;\n            background-color: var(--accent-color);\n            color: white;\n            border: none;\n            border-radius: 5px;\n            font-size: 16px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.2s;\n        }\n        \n        .submit-btn:hover {\n            opacity: 0.8;\n        }\n        \n        .posts-section {\n            margin-top: 10px;\n        }\n        \n        .section-title {\n            background-color: var(--header-bg);\n            padding: 12px 15px;\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--text-primary);\n            border-top: 1px solid var(--border-color);\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .post-item {\n            background-color: var(--card-bg);\n            margin-bottom: 10px;\n            padding: 15px;\n            position: relative;\n        }\n        \n        .post-header {\n            display: flex;\n            align-items: center;\n            margin-bottom: 10px;\n            padding-bottom: 10px;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .avatar {\n            width: 40px;\n            height: 40px;\n            border-radius: 5px;\n            margin-right: 12px;\n            background-image: url('https://imgbed.mcyzsx.top/file/avatar/1765626136745_zsxcoder.jpg');\n            background-size: cover;\n            background-position: center;\n            background-repeat: no-repeat;\n        }\n        \n        .post-info {\n            flex: 1;\n        }\n        \n        .post-meta {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n        \n        .post-date { \n            color: var(--text-tertiary); \n            font-size: 12px; \n        }\n        \n        .post-tags {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 5px;\n        }\n        \n        .tag { \n            background-color: var(--button-bg);\n            color: var(--text-secondary);\n            padding: 2px 8px;\n            border-radius: 10px;\n            font-size: 12px;\n        }\n        \n        .post-content {\n            margin: 10px 0;\n            font-size: 16px;\n            line-height: 1.6;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n        }\n        \n        .post-content img { \n            max-width: 100%; \n            border-radius: 6px;\n            margin: 10px 0;\n            display: block;\n        }\n        \n        .post-content h1, .post-content h2, .post-content h3 {\n            margin: 10px 0;\n            font-size: 16px;\n            font-weight: 500;\n        }\n        \n        .post-content p {\n            margin: 5px 0;\n        }\n        \n        .post-content code {\n            background: var(--code-bg);\n            padding: 2px 4px;\n            border-radius: 3px;\n            font-family: 'Monaco', 'Consolas', monospace;\n            font-size: 14px;\n        }\n        \n        .post-content pre {\n            background: var(--code-bg);\n            padding: 10px;\n            border-radius: 6px;\n            overflow-x: auto;\n            margin: 10px 0;\n            font-size: 14px;\n        }\n        \n        .post-content blockquote {\n            border-left: 3px solid var(--border-color);\n            padding-left: 10px;\n            margin: 10px 0;\n            color: var(--text-secondary);\n            font-style: italic;\n        }\n        \n        .post-actions {\n            display: flex;\n            gap: 10px;\n            margin-top: 15px;\n            padding-top: 10px;\n            border-top: 1px solid var(--border-color);\n        }\n        \n        .action-btn {\n            padding: 6px 12px;\n            border: 1px solid var(--border-color);\n            border-radius: 5px;\n            font-size: 14px;\n            text-decoration: none;\n            color: var(--text-primary);\n            display: inline-flex;\n            align-items: center;\n            gap: 5px;\n            transition: all 0.2s;\n        }\n        \n        .action-btn:hover {\n            background-color: var(--button-bg);\n        }\n        \n        .edit-btn {\n            color: var(--accent-color);\n            border-color: var(--accent-color);\n        }\n        \n        .edit-btn:hover {\n            background-color: rgba(123, 138, 184, 0.1);\n        }\n        \n        .delete-btn {\n            color: #ff3b30;\n            border-color: #ff3b30;\n        }\n        \n        .delete-btn:hover {\n            background-color: rgba(255, 59, 48, 0.1);\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 40px 20px;\n            color: var(--text-tertiary);\n            background-color: var(--card-bg);\n        }\n        \n        .empty-state h3 {\n            font-size: 18px;\n            margin-bottom: 10px;\n            color: var(--text-secondary);\n        }\n        \n        @media (max-width: 620px) {\n            .admin-container {\n                padding: 0;\n            }\n            \n            .post-item {\n                border-radius: 0;\n                margin-left: -10px;\n                margin-right: -10px;\n            }\n            \n            .compose-box {\n                border-radius: 0;\n                margin-left: -10px;\n                margin-right: -10px;\n            }\n        }\n        \n        ${getThemeCSS()}\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <div class=\"header-title\">\u670B\u53CB\u5708\u7BA1\u7406</div>\n    </div>\n    \n    <div class=\"header-buttons\">\n        <a href=\"/\" class=\"home-btn\">\u9996\u9875</a>\n        <a href=\"/admin/logout\" class=\"logout-btn\" onclick=\"return confirm('\u786E\u5B9A\u8981\u9000\u51FA\u767B\u5F55\u5417\uFF1F')\">\u9000\u51FA</a>\n    </div>\n    \n    <div class=\"content\">\n        <div class=\"admin-container\">\n            <div class=\"compose-box\">\n                <h3 class=\"compose-title\">\u53D1\u5E03\u65B0\u52A8\u6001</h3>\n                <form method=\"POST\" enctype=\"multipart/form-data\">\n                    <div class=\"form-group\">\n                        <textarea name=\"content\" placeholder=\"\u5206\u4EAB\u4F60\u7684\u60F3\u6CD5...\" required></textarea>\n                    </div>\n                    <div class=\"form-group\">\n                        <input type=\"text\" name=\"tags\" placeholder=\"\u6807\u7B7E (\u7528\u9017\u53F7\u5206\u9694\uFF0C\u5982: \u751F\u6D3B, \u5DE5\u4F5C, \u5B66\u4E60)\">\n                    </div>\n                    <div class=\"form-group\">\n                        <input type=\"file\" name=\"image\" accept=\"image/*\">\n                    </div>\n                    <button type=\"submit\" class=\"submit-btn\">\u53D1\u5E03</button>\n                </form>\n            </div>\n\n            <div class=\"posts-section\">\n                <div class=\"section-title\">\u5DF2\u53D1\u5E03\u52A8\u6001</div>\n                ${posts.length === 0 ? `\n                    <div class=\"empty-state\">\n                        <h3>\u8FD8\u6CA1\u6709\u52A8\u6001</h3>\n                        <p>\u53D1\u5E03\u4F60\u7684\u7B2C\u4E00\u6761\u52A8\u6001\u5427\uFF01</p>\n                    </div>\n                ` : posts.map(post => `\n                    <div class=\"post-item\">\n                        <div class=\"post-header\">\n                            <div class=\"avatar\"></div>\n                            <div class=\"post-info\">\n                                <div class=\"post-meta\">\n                                    <div class=\"post-date\">${post.date}</div>\n                                    <div class=\"post-tags\">\n                                        ${post.tags.map(tag => `<span class=\"tag\">#${tag}</span>`).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"post-content\" data-markdown=\"${encodeURIComponent(post.content)}\"></div>\n                        <div class=\"post-actions\">\n                            <a href=\"/admin/edit/${post.id}\" class=\"action-btn edit-btn\">\n                                \u270F\uFE0F \u7F16\u8F91\n                            </a>\n                            <a href=\"/admin/delete/${post.id}\" class=\"action-btn delete-btn\" onclick=\"return confirm('\u786E\u5B9A\u5220\u9664\u8FD9\u6761\u52A8\u6001\u5417\uFF1F')\">\n                                \uD83D\uDDD1\uFE0F \u5220\u9664\n                            </a>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // \u6E32\u67D3 Markdown \u5185\u5BB9\n        document.querySelectorAll('.post-content').forEach(element => {\n            const markdown = decodeURIComponent(element.dataset.markdown);\n            element.innerHTML = marked.parse(markdown);\n        });\n    </script>\n    \n    ${getThemeToggleScript()}\n    \n    <!-- \u4E3B\u9898\u5207\u6362\u6309\u94AE -->\n    ${getThemeToggleHTML()}\n</body>\n</html>`;\n}\n\nfunction getEditHTML(post) {\n  return `\n<!DOCTYPE html>\n<html>\n<head>\n    <title>\u7F16\u8F91\u52A8\u6001</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n            font-family: -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei\", sans-serif;\n            background-color: var(--bg-primary);\n            color: var(--text-primary);\n            font-size: 16px;\n            line-height: 1.5;\n        }\n        \n        .header { \n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 46px;\n            background-color: var(--header-bg);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .header-title {\n            font-size: 18px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .header-left {\n            position: fixed;\n            top: 0;\n            left: 10px;\n            height: 46px;\n            display: flex;\n            align-items: center;\n            z-index: 1001;\n        }\n        \n        .header-right { \n            position: fixed;\n            top: 0;\n            right: 10px;\n            height: 46px;\n            display: flex;\n            gap: 10px;\n            align-items: center;\n            z-index: 1001;\n        }\n        \n        .back-link, .logout-btn, .home-btn { \n            color: var(--accent-color); \n            padding: 6px 12px; \n            text-decoration: none; \n            font-size: 14px;\n            transition: opacity 0.2s;\n        }\n        \n        .back-link:hover, .logout-btn:hover, .home-btn:hover { \n            opacity: 0.8; \n        }\n        \n        .content {\n            padding-top: 56px;\n            padding-bottom: 20px;\n            background-color: var(--bg-primary);\n        }\n        \n        .edit-container {\n            max-width: 620px;\n            margin: 0 auto;\n            padding: 0 10px;\n        }\n        \n        .edit-form {\n            background-color: var(--card-bg);\n            padding: 15px;\n            border-radius: 8px;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n        }\n        \n        .form-title {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            color: var(--text-primary);\n            text-align: center;\n        }\n        \n        .post-info {\n            background-color: var(--button-bg);\n            padding: 12px;\n            border-radius: 5px;\n            margin-bottom: 15px;\n            font-size: 14px;\n            color: var(--text-secondary);\n        }\n        \n        .form-group {\n            margin-bottom: 15px;\n        }\n        \n        .form-group label {\n            display: block;\n            margin-bottom: 5px;\n            color: var(--text-primary);\n            font-size: 14px;\n        }\n        \n        textarea, input[type=\"text\"], input[type=\"file\"] {\n            width: 100%;\n            padding: 10px;\n            border: 1px solid var(--border-color);\n            border-radius: 5px;\n            font-size: 16px;\n            font-family: inherit;\n            background-color: var(--card-bg);\n            color: var(--text-primary);\n        }\n        \n        textarea {\n            height: 120px;\n            resize: vertical;\n            min-height: 100px;\n        }\n        \n        textarea:focus, input:focus {\n            outline: none;\n            border-color: var(--accent-color);\n        }\n        \n        .form-help {\n            font-size: 12px;\n            color: var(--text-tertiary);\n            margin-top: 5px;\n        }\n        \n        .form-actions {\n            display: flex;\n            gap: 10px;\n            margin-top: 20px;\n        }\n        \n        .submit-btn {\n            flex: 1;\n            padding: 10px;\n            background-color: var(--accent-color);\n            color: white;\n            border: none;\n            border-radius: 5px;\n            font-size: 16px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.2s;\n        }\n        \n        .submit-btn:hover {\n            opacity: 0.8;\n        }\n        \n        .cancel-btn {\n            flex: 1;\n            padding: 10px;\n            background-color: var(--button-bg);\n            color: var(--text-primary);\n            border: none;\n            border-radius: 5px;\n            font-size: 16px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.2s;\n            text-decoration: none;\n            text-align: center;\n        }\n        \n        .cancel-btn:hover {\n            opacity: 0.8;\n        }\n        \n        @media (max-width: 620px) {\n            .edit-container {\n                padding: 0;\n            }\n            \n            .edit-form {\n                border-radius: 0;\n                margin-left: -10px;\n                margin-right: -10px;\n            }\n        }\n        \n        ${getThemeCSS()}\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <div class=\"header-title\">\u7F16\u8F91\u52A8\u6001</div>\n    </div>\n    \n    <div class=\"header-left\">\n        <a href=\"/admin\" class=\"back-link\">\u8FD4\u56DE</a>\n    </div>\n    \n    <div class=\"header-right\">\n        <a href=\"/\" class=\"home-btn\">\u9996\u9875</a>\n        <a href=\"/admin/logout\" class=\"logout-btn\" onclick=\"return confirm('\u786E\u5B9A\u8981\u9000\u51FA\u767B\u5F55\u5417\uFF1F')\">\u9000\u51FA</a>\n    </div>\n    \n    <div class=\"content\">\n        <div class=\"edit-container\">\n            <div class=\"edit-form\">\n                <h3 class=\"form-title\">\u7F16\u8F91\u52A8\u6001</h3>\n                \n                <div class=\"post-info\">\n                    <div>\u521B\u5EFA\u65F6\u95F4: ${post.date}</div>\n                    <div>\u52A8\u6001 ID: ${post.id}</div>\n                    ${post.updatedAt ? `<div>\u6700\u540E\u66F4\u65B0: ${post.updatedAt}</div>` : ''}\n                </div>\n                \n                <form method=\"POST\" enctype=\"multipart/form-data\">\n                    <div class=\"form-group\">\n                        <textarea name=\"content\" required>${post.content}</textarea>\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <input type=\"text\" name=\"tags\" value=\"${post.tags.join(', ')}\" placeholder=\"\u6807\u7B7E (\u7528\u9017\u53F7\u5206\u9694)\">\n                    </div>\n                    \n                    <div class=\"form-group\">\n                        <input type=\"file\" name=\"image\" accept=\"image/*\">\n                        <div class=\"form-help\">\u5982\u679C\u4E0D\u9009\u62E9\u65B0\u56FE\u7247\uFF0C\u5C06\u4FDD\u6301\u539F\u6709\u56FE\u7247</div>\n                    </div>\n                    \n                    <div class=\"form-actions\">\n                        <button type=\"submit\" class=\"submit-btn\">\u4FDD\u5B58</button>\n                        <a href=\"/admin\" class=\"cancel-btn\">\u53D6\u6D88</a>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n    \n    ${getThemeToggleScript()}\n    \n    <!-- \u4E3B\u9898\u5207\u6362\u6309\u94AE -->\n    ${getThemeToggleHTML()}\n</body>\n</html>`;\n}", "/**\n * \u5B58\u50A8\u670D\u52A1\u62BD\u8C61\u5C42\uFF0C\u652F\u6301 Cloudflare R2 \u548C\u963F\u91CC\u4E91 OSS\n */\n\n/**\n * \u4E0A\u4F20\u6587\u4EF6\u5230\u5B58\u50A8\u670D\u52A1\n * @param {Object} options - \u4E0A\u4F20\u9009\u9879\n * @param {ReadableStream} options.stream - \u6587\u4EF6\u6D41\n * @param {string} options.key - \u6587\u4EF6\u952E\u540D/\u8DEF\u5F84\n * @param {string} options.contentType - \u6587\u4EF6\u7C7B\u578B\n * @param {Object} env - \u73AF\u5883\u53D8\u91CF\n * @param {string} env.STORAGE_TYPE - \u5B58\u50A8\u7C7B\u578B ('R2' \u6216 'OSS')\n * @param {Object} env.POST_BUCKET - R2 \u5B58\u50A8\u6876\n * @param {string} env.OSS_REGION - OSS \u533A\u57DF\n * @param {string} env.OSS_BUCKET - OSS \u5B58\u50A8\u6876\u540D\n * @param {string} env.OSS_ACCESS_KEY_ID - OSS \u8BBF\u95EE\u5BC6\u94A5 ID\n * @param {string} env.OSS_ACCESS_KEY_SECRET - OSS \u8BBF\u95EE\u5BC6\u94A5\n * @returns {Promise<string>} \u6587\u4EF6\u7684 URL\n */\nexport async function uploadFile({ stream, key, contentType }, env) {\n  const storageType = env.STORAGE_TYPE || 'R2';\n  \n  if (storageType === 'R2') {\n    return uploadToR2({ stream, key, contentType }, env);\n  } else if (storageType === 'OSS') {\n    return uploadToOSS({ stream, key, contentType }, env);\n  } else {\n    throw new Error(`\u4E0D\u652F\u6301\u7684\u5B58\u50A8\u7C7B\u578B: ${storageType}`);\n  }\n}\n\n/**\n * \u4ECE\u5B58\u50A8\u670D\u52A1\u83B7\u53D6\u6587\u4EF6\n * @param {string} key - \u6587\u4EF6\u952E\u540D/\u8DEF\u5F84\n * @param {Object} env - \u73AF\u5883\u53D8\u91CF\n * @returns {Promise<Object|null>} \u6587\u4EF6\u5BF9\u8C61\u6216 null\n */\nexport async function getFile(key, env) {\n  const storageType = env.STORAGE_TYPE || 'R2';\n  \n  if (storageType === 'R2') {\n    return getFromR2(key, env);\n  } else if (storageType === 'OSS') {\n    return getFromOSS(key, env);\n  } else {\n    throw new Error(`\u4E0D\u652F\u6301\u7684\u5B58\u50A8\u7C7B\u578B: ${storageType}`);\n  }\n}\n\n/**\n * \u83B7\u53D6\u6587\u4EF6\u7684\u516C\u5F00 URL\n * @param {string} key - \u6587\u4EF6\u952E\u540D/\u8DEF\u5F84\n * @param {Object} env - \u73AF\u5883\u53D8\u91CF\n * @param {Object} request - \u8BF7\u6C42\u5BF9\u8C61\uFF0C\u7528\u4E8E\u6784\u5EFA URL\n * @returns {string} \u6587\u4EF6\u7684\u516C\u5F00 URL\n */\nexport async function getFileUrl(key, env, request) {\n  const storageType = env.STORAGE_TYPE || 'R2';\n  \n  if (storageType === 'R2') {\n    const url = new URL(request.url);\n    return `${url.protocol}//${url.host}/images/${key}`;\n  } else if (storageType === 'OSS') {\n    // OSS \u9700\u8981\u6839\u636E\u914D\u7F6E\u6784\u5EFA\u516C\u5F00 URL\n    const domain = env.OSS_DOMAIN || `${env.OSS_BUCKET}.${env.OSS_REGION}.aliyuncs.com`;\n    return `https://${domain}/${key}`;\n  } else {\n    throw new Error(`\u4E0D\u652F\u6301\u7684\u5B58\u50A8\u7C7B\u578B: ${storageType}`);\n  }\n}\n\n/**\n * \u4E0A\u4F20\u6587\u4EF6\u5230 Cloudflare R2\n * @private\n */\nasync function uploadToR2({ stream, key, contentType }, env) {\n  const uploadResult = await env.POST_BUCKET.put(key, stream, {\n    httpMetadata: {\n      contentType: contentType || 'image/jpeg'\n    }\n  });\n  \n  if (!uploadResult) {\n    throw new Error('\u4E0A\u4F20\u5230 R2 \u5931\u8D25');\n  }\n  \n  return key; // R2 \u8FD4\u56DE\u952E\u540D\uFF0C\u540E\u7EED\u901A\u8FC7 getFileUrl \u83B7\u53D6\u5B8C\u6574 URL\n}\n\n/**\n * \u4ECE Cloudflare R2 \u83B7\u53D6\u6587\u4EF6\n * @private\n */\nasync function getFromR2(key, env) {\n  return await env.POST_BUCKET.get(key);\n}\n\n/**\n * \u4E0A\u4F20\u6587\u4EF6\u5230\u963F\u91CC\u4E91 OSS\n * @private\n */\nasync function uploadToOSS({ stream, key, contentType }, env) {\n  const {\n    OSS_REGION,\n    OSS_BUCKET,\n    OSS_ACCESS_KEY_ID,\n    OSS_ACCESS_KEY_SECRET\n  } = env;\n  \n  if (!OSS_REGION || !OSS_BUCKET || !OSS_ACCESS_KEY_ID || !OSS_ACCESS_KEY_SECRET) {\n    throw new Error('OSS \u914D\u7F6E\u4E0D\u5B8C\u6574');\n  }\n  \n  // \u5C06\u6D41\u8F6C\u4E3A ArrayBuffer\n  const arrayBuffer = await streamToArrayBuffer(stream);\n  \n  // \u6784\u5EFA OSS \u8BF7\u6C42\n  const host = `${OSS_BUCKET}.${OSS_REGION}.aliyuncs.com`;\n  const date = new Date().toUTCString();\n  const contentTypeValue = contentType || 'image/jpeg';\n  \n  // \u8BA1\u7B97\u7B7E\u540D\n  const stringToSign = `PUT\\n\\n${contentTypeValue}\\n${date}\\n/${OSS_BUCKET}/${key}`;\n  const signature = await generateSignature(stringToSign, OSS_ACCESS_KEY_SECRET);\n  \n  const response = await fetch(`https://${host}/${key}`, {\n    method: 'PUT',\n    headers: {\n      'Host': host,\n      'Date': date,\n      'Content-Type': contentTypeValue,\n      'Authorization': `OSS ${OSS_ACCESS_KEY_ID}:${signature}`,\n      'Content-Length': arrayBuffer.byteLength.toString()\n    },\n    body: arrayBuffer\n  });\n  \n  if (!response.ok) {\n    throw new Error(`OSS \u4E0A\u4F20\u5931\u8D25: ${response.status} ${response.statusText}`);\n  }\n  \n  return key; // OSS \u8FD4\u56DE\u952E\u540D\uFF0C\u540E\u7EED\u901A\u8FC7 getFileUrl \u83B7\u53D6\u5B8C\u6574 URL\n}\n\n/**\n * \u4ECE\u963F\u91CC\u4E91 OSS \u83B7\u53D6\u6587\u4EF6\n * @private\n */\nasync function getFromOSS(key, env) {\n  const domain = env.OSS_DOMAIN || `${env.OSS_BUCKET}.${env.OSS_REGION}.aliyuncs.com`;\n  const url = `https://${domain}/${key}`;\n  \n  const response = await fetch(url);\n  \n  if (!response.ok) {\n    return null;\n  }\n  \n  return {\n    body: response.body,\n    httpMetadata: {\n      contentType: response.headers.get('content-type') || 'image/jpeg'\n    }\n  };\n}\n\n/**\n * \u5C06 ReadableStream \u8F6C\u6362\u4E3A ArrayBuffer\n * @private\n */\nasync function streamToArrayBuffer(stream) {\n  const reader = stream.getReader();\n  const chunks = [];\n  let totalLength = 0;\n  \n  while (true) {\n    const { done, value } = await reader.read();\n    if (done) break;\n    \n    chunks.push(value);\n    totalLength += value.length;\n  }\n  \n  const result = new Uint8Array(totalLength);\n  let position = 0;\n  \n  for (const chunk of chunks) {\n    result.set(chunk, position);\n    position += chunk.length;\n  }\n  \n  return result.buffer;\n}\n\n/**\n * \u751F\u6210\u963F\u91CC\u4E91 OSS \u7B7E\u540D\n * @private\n */\nasync function generateSignature(stringToSign, accessKeySecret) {\n  const encoder = new TextEncoder();\n  const keyData = encoder.encode(accessKeySecret);\n  const messageData = encoder.encode(stringToSign);\n  \n  const cryptoKey = await crypto.subtle.importKey(\n    'raw',\n    keyData,\n    { name: 'HMAC', hash: 'SHA-1' },\n    false,\n    ['sign']\n  );\n  \n  const signatureBuffer = await crypto.subtle.sign('HMAC', cryptoKey, messageData);\n  const signature = Array.from(new Uint8Array(signatureBuffer))\n    .map(b => String.fromCharCode(b))\n    .join('');\n  \n  return btoa(signature);\n}", "import { verifySession } from './utils.js';\n\n/**\n * \u4F1A\u8BDD\u4E2D\u95F4\u4EF6\uFF0C\u7528\u4E8E\u5904\u7406\u8BA4\u8BC1\u548C\u4F1A\u8BDD\u7BA1\u7406\n * @param {Request} request - \u8BF7\u6C42\u5BF9\u8C61\n * @param {Object} env - \u73AF\u5883\u53D8\u91CF\n * @param {Function} handler - \u5904\u7406\u51FD\u6570\n * @param {boolean} requireAuth - \u662F\u5426\u9700\u8981\u8BA4\u8BC1\n * @returns {Promise<Response>} \u54CD\u5E94\u5BF9\u8C61\n */\nexport async function withSession(request, env, handler, requireAuth = true) {\n  const url = new URL(request.url);\n  \n  // \u9A8C\u8BC1\u4F1A\u8BDD\n  const authResult = await verifySession(request, env);\n  const isAuthenticated = typeof authResult === 'boolean' ? authResult : authResult.valid;\n  \n  // \u5982\u679C\u9700\u8981\u8BA4\u8BC1\u4F46\u672A\u8BA4\u8BC1\uFF0C\u91CD\u5B9A\u5411\u5230\u767B\u5F55\u9875\n  if (requireAuth && !isAuthenticated && url.pathname !== '/admin/login') {\n    const baseUrl = `${url.protocol}//${url.host}`;\n    return Response.redirect(`${baseUrl}/admin/login`);\n  }\n  \n  // \u8BBE\u7F6E\u521D\u59CB\u54CD\u5E94\u5934\n  const headers = {};\n  \n  // \u5982\u679C\u4F1A\u8BDD\u6709\u6548\u4E14\u9700\u8981\u66F4\u65B0 Cookie\n  if (isAuthenticated && typeof authResult === 'object' && authResult.needsCookieUpdate) {\n    // \u83B7\u53D6\u5F53\u524D session token\n    const cookieHeader = request.headers.get('Cookie');\n    const cookies = cookieHeader ? cookieHeader.split(';').reduce((acc, cookie) => {\n      const [key, ...values] = cookie.trim().split('=');\n      if (key && values.length > 0) {\n        acc[key] = values.join('=');\n      }\n      return acc;\n    }, {}) : {};\n    \n    const sessionToken = cookies.session;\n    if (sessionToken) {\n      headers['Set-Cookie'] = `session=${sessionToken}; HttpOnly; Secure; SameSite=Lax; Max-Age=604800; Path=/;`;\n    }\n  }\n  \n  // \u8C03\u7528\u5904\u7406\u51FD\u6570\n  let response = await handler(request, env, authResult);\n  \n  // \u5982\u679C\u5904\u7406\u51FD\u6570\u8FD4\u56DE\u7684\u662F Response \u5BF9\u8C61\uFF0C\u6DFB\u52A0\u6211\u4EEC\u7684\u5934\u4FE1\u606F\n  if (response instanceof Response) {\n    // \u5408\u5E76\u5934\u4FE1\u606F\n    const newHeaders = new Headers(response.headers);\n    Object.entries(headers).forEach(([key, value]) => {\n      // \u53EA\u6709\u5F53\u54CD\u5E94\u4E2D\u8FD8\u6CA1\u6709\u8FD9\u4E2A\u5934\u4FE1\u606F\u65F6\u624D\u6DFB\u52A0\n      if (!newHeaders.has(key)) {\n        newHeaders.set(key, value);\n      }\n    });\n    \n    // \u521B\u5EFA\u65B0\u7684\u54CD\u5E94\u5BF9\u8C61\uFF0C\u4FDD\u6301\u539F\u59CB\u54CD\u5E94\u7684\u72B6\u6001\u548C\u4F53\n    return new Response(response.body, {\n      status: response.status,\n      statusText: response.statusText,\n      headers: newHeaders\n    });\n  }\n  \n  return response;\n}\n\n/**\n * \u521B\u5EFA\u4E00\u4E2A\u5E26\u6709\u4F1A\u8BDD\u7684 HTML \u54CD\u5E94\n * @param {string} html - HTML \u5185\u5BB9\n * @param {Object} headers - \u989D\u5916\u7684\u5934\u4FE1\u606F\n * @returns {Response} \u54CD\u5E94\u5BF9\u8C61\n */\nexport function createHTMLResponse(html, headers = {}) {\n  return new Response(html, {\n    headers: {\n      'Content-Type': 'text/html; charset=utf-8',\n      ...headers\n    }\n  });\n}\n\n/**\n * \u521B\u5EFA\u4E00\u4E2A\u5E26\u6709\u4F1A\u8BDD\u7684\u91CD\u5B9A\u5411\u54CD\u5E94\n * @param {string} location - \u91CD\u5B9A\u5411 URL\n * @param {Object} headers - \u989D\u5916\u7684\u5934\u4FE1\u606F\n * @returns {Response} \u54CD\u5E94\u5BF9\u8C61\n */\nexport function createRedirectResponse(location, headers = {}) {\n  return new Response(null, {\n    status: 302,\n    headers: {\n      'Location': location,\n      ...headers\n    }\n  });\n}", "// \u4E3B\u9898\u5207\u6362\u5DE5\u5177\u51FD\u6570\nexport function getThemeToggleHTML() {\n  return `\n    <div class=\"theme-toggle\" id=\"theme-toggle\" title=\"\u5207\u6362\u6DF1\u8272/\u6D45\u8272\u6A21\u5F0F\">\n      <svg class=\"theme-icon sun-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"5\"></circle>\n        <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\"></line>\n        <line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\"></line>\n        <line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\"></line>\n        <line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\"></line>\n        <line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\"></line>\n        <line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\"></line>\n        <line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\"></line>\n        <line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\"></line>\n      </svg>\n      <svg class=\"theme-icon moon-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"></path>\n      </svg>\n    </div>\n  `;\n}\n\nexport function getThemeToggleScript() {\n  return `\n    <script>\n      (function() {\n        console.log('Theme script loading...');\n        \n        // \u7B49\u5F85DOM\u5B8C\u5168\u52A0\u8F7D\n        function initThemeToggle() {\n          console.log('Initializing theme toggle...');\n          \n          // \u83B7\u53D6\u4E3B\u9898\u5207\u6362\u6309\u94AE\n          const themeToggle = document.getElementById('theme-toggle');\n          console.log('Theme toggle element:', themeToggle);\n          \n          if (!themeToggle) {\n            console.log('Theme toggle button not found, retrying in 100ms...');\n            setTimeout(initThemeToggle, 100);\n            return;\n          }\n          \n          // \u66F4\u65B0\u56FE\u6807\u663E\u793A\u7684\u51FD\u6570\n          function updateIcon(theme) {\n            console.log('Updating icon for theme:', theme);\n            const sunIcon = themeToggle.querySelector('.sun-icon');\n            const moonIcon = themeToggle.querySelector('.moon-icon');\n            \n            if (!sunIcon || !moonIcon) {\n              console.log('Icons not found:', { sunIcon, moonIcon });\n              return;\n            }\n            \n            if (theme === 'dark') {\n              sunIcon.style.display = 'none';\n              moonIcon.style.display = 'block';\n            } else {\n              sunIcon.style.display = 'block';\n              moonIcon.style.display = 'none';\n            }\n          }\n          \n          // \u83B7\u53D6\u6216\u521D\u59CB\u5316\u4E3B\u9898\n          const currentTheme = localStorage.getItem('theme') || 'light';\n          console.log('Current theme:', currentTheme);\n          document.documentElement.setAttribute('data-theme', currentTheme);\n          updateIcon(currentTheme);\n          \n          // \u6DFB\u52A0\u70B9\u51FB\u4E8B\u4EF6\n          themeToggle.addEventListener('click', function(e) {\n            console.log('Theme toggle clicked');\n            e.preventDefault();\n            \n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            \n            console.log('Switching from', currentTheme, 'to', newTheme);\n            \n            document.documentElement.setAttribute('data-theme', newTheme);\n            localStorage.setItem('theme', newTheme);\n            updateIcon(newTheme);\n          });\n          \n          console.log('Theme toggle initialized successfully!');\n        }\n        \n        // \u7ACB\u5373\u521D\u59CB\u5316\uFF0C\u5982\u679CDOM\u8FD8\u6CA1\u51C6\u5907\u597D\u5C31\u7B49\u5F85\n        if (document.readyState === 'loading') {\n          document.addEventListener('DOMContentLoaded', initThemeToggle);\n        } else {\n          initThemeToggle();\n        }\n      })();\n    <\\/script>\n  `;\n}\n\nexport function getThemeCSS() {\n  return `\n    /* \u4E3B\u9898\u5207\u6362\u6309\u94AE\u6837\u5F0F */\n    .theme-toggle {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 50px;\n      height: 50px;\n      border-radius: 50%;\n      background-color: #fff;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      z-index: 1000;\n      transition: all 0.3s ease;\n    }\n    \n    .theme-toggle:hover {\n      transform: scale(1.1);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    }\n    \n    .theme-icon {\n      width: 24px;\n      height: 24px;\n      color: #576b95;\n      transition: all 0.3s ease;\n    }\n    \n    .moon-icon {\n      display: none;\n    }\n    \n    /* \u6DF1\u8272\u6A21\u5F0F\u6837\u5F0F */\n    [data-theme=\"dark\"] {\n      --bg-primary: #1a1a1a;\n      --bg-secondary: #252525;\n      --bg-tertiary: #303030;\n      --text-primary: #e6e6e6;\n      --text-secondary: #b0b0b0;\n      --text-tertiary: #888;\n      --border-color: #404040;\n      --accent-color: #7b8ab8;\n      --header-bg: #252525;\n      --card-bg: #252525;\n      --button-bg: #3a3a3a;\n      --code-bg: #1e1e1e;\n      --blockquote-bg: #2a2a2a;\n      --link-color: #ffffff;\n      --link-color-hover: #e0e0e0;\n    }\n    \n    [data-theme=\"light\"] {\n      --bg-primary: #ededed;\n      --bg-secondary: #ffffff;\n      --bg-tertiary: #f7f7f7;\n      --text-primary: #333333;\n      --text-secondary: #666666;\n      --text-tertiary: #999999;\n      --border-color: #dcdcdc;\n      --accent-color: #576b95;\n      --header-bg: #ededed;\n      --card-bg: #ffffff;\n      --button-bg: #f5f5f5;\n      --code-bg: #f1f3f4;\n      --blockquote-bg: #f8f9fa;\n      --link-color: #576b95;\n      --link-color-hover: #4a5d84;\n    }\n    \n    /* \u5E94\u7528\u4E3B\u9898\u53D8\u91CF\u5230\u73B0\u6709\u6837\u5F0F */\n    body {\n      background-color: var(--bg-primary);\n      color: var(--text-primary);\n    }\n    \n    .header {\n      background-color: var(--header-bg);\n      border-bottom-color: var(--border-color);\n    }\n    \n    .header-title {\n      color: var(--text-primary);\n    }\n    \n    .post, .compose-box, .login-card, .edit-form {\n      background-color: var(--card-bg);\n    }\n    \n    .post-content, .post-date, .username {\n      color: var(--text-primary);\n    }\n    \n    .post-date {\n      color: var(--text-tertiary);\n    }\n    \n    .post-content code {\n      background: var(--code-bg);\n    }\n    \n    .post-content pre {\n      background: var(--code-bg);\n    }\n    \n    .post-content blockquote {\n      background: var(--blockquote-bg);\n      border-left-color: var(--border-color);\n    }\n    \n    .action-btn, .login-btn, .admin-btn, .logout-btn, .home-btn {\n      color: var(--accent-color);\n    }\n    \n    .action-btn:hover {\n      color: var(--accent-color);\n    }\n    \n    /* \u94FE\u63A5\u6837\u5F0F */\n    a {\n      color: var(--link-color);\n      text-decoration: none;\n      transition: color 0.2s ease;\n    }\n    \n    a:hover {\n      color: var(--link-color-hover);\n      text-decoration: underline;\n    }\n    \n    .post-content a {\n      color: var(--link-color);\n      text-decoration: underline;\n      font-weight: 500;\n    }\n    \n    .post-content a:hover {\n      color: var(--link-color-hover);\n      text-decoration: underline;\n    }\n    \n    textarea, input[type=\"text\"], input[type=\"file\"] {\n      background-color: var(--card-bg);\n      border-color: var(--border-color);\n      color: var(--text-primary);\n    }\n    \n    .submit-btn {\n      background-color: var(--accent-color);\n    }\n    \n    .cancel-btn {\n      background-color: var(--button-bg);\n      color: var(--text-primary);\n    }\n    \n    .tag {\n      background-color: var(--button-bg);\n      color: var(--text-secondary);\n    }\n    \n    .divider {\n      background-color: var(--bg-primary);\n    }\n    \n    .empty-state {\n      background-color: var(--card-bg);\n      color: var(--text-secondary);\n    }\n    \n    .features {\n      background-color: var(--button-bg);\n    }\n    \n    .security-note {\n      background-color: rgba(123, 138, 184, 0.1);\n      border-left-color: var(--accent-color);\n    }\n    \n    [data-theme=\"dark\"] .theme-toggle {\n      background-color: #2a2a2a;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);\n    }\n    \n    [data-theme=\"dark\"] .theme-icon {\n      color: #7b8ab8;\n    }\n  `;\n}", "import { getAllPosts } from './utils.js';\r\nimport { getFile, getFileUrl } from './storage.js';\r\nimport { getThemeToggleHTML, getThemeToggleScript, getThemeCSS } from './theme.js';\r\n\r\nexport async function handlePublic(request, env, dbWrapper = null) {\r\n  const url = new URL(request.url);\r\n  \r\n  if (url.pathname.startsWith('/images/')) {\r\n    const imageKey = url.pathname.replace('/images/', '');\r\n    const storageType = env.STORAGE_TYPE || 'R2';\r\n    \r\n    // \u5982\u679C\u4F7F\u7528 OSS\uFF0C\u76F4\u63A5\u91CD\u5B9A\u5411\u5230 OSS \u4E0A\u7684\u8D44\u6E90\r\n    if (storageType === 'OSS') {\r\n      const ossUrl = await getFileUrl(imageKey, env, request);\r\n      return Response.redirect(ossUrl);\r\n    }\r\n    \r\n    // \u5BF9\u4E8E R2\uFF0C\u76F4\u63A5\u63D0\u4F9B\u6587\u4EF6\u5185\u5BB9\r\n    const object = await getFile(imageKey, env);\r\n    \r\n    if (!object) {\r\n      return new Response('\u56FE\u7247\u672A\u627E\u5230', { status: 404 });\r\n    }\r\n\r\n    return new Response(object.body, {\r\n      headers: {\r\n        'Content-Type': object.httpMetadata?.contentType || 'image/jpeg',\r\n        'Cache-Control': 'public, max-age=31536000',\r\n      },\r\n    });\r\n  }\r\n\r\n  // \u4E3B\u9875\u5C55\u793A - \u4F7F\u7528\u6570\u636E\u5E93\u5305\u88C5\u5668\r\n  const posts = dbWrapper ? await dbWrapper.getAllPosts() : await getAllPosts(env.POSTS_KV);\r\n  return new Response(getPublicHTML(posts), {\r\n    headers: { 'Content-Type': 'text/html; charset=utf-8' },\r\n  });\r\n}\r\n\r\nfunction getPublicHTML(posts) {\r\n  return `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>\u670B\u53CB\u5708</title>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\r\n    <style>\r\n        * { margin: 0; padding: 0; box-sizing: border-box; }\r\n        \r\n        body { \r\n            font-family: -apple-system, BlinkMacSystemFont, \"Helvetica Neue\", \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei\", sans-serif;\r\n            background-color: var(--bg-primary);\r\n            color: var(--text-primary);\r\n            font-size: 16px;\r\n            line-height: 1.5;\r\n        }\r\n        \r\n        .header { \r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            height: 46px;\r\n            background-color: var(--header-bg);\r\n            border-bottom: 1px solid var(--border-color);\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n            z-index: 1000;\r\n        }\r\n        \r\n        .header-title {\r\n            font-size: 18px;\r\n            font-weight: 600;\r\n            color: var(--text-primary);\r\n        }\r\n        \r\n        .header-buttons { \r\n            position: fixed;\r\n            top: 0;\r\n            right: 10px;\r\n            height: 46px;\r\n            display: flex;\r\n            gap: 10px;\r\n            align-items: center;\r\n            z-index: 1001;\r\n        }\r\n        \r\n        .login-btn, .admin-btn { \r\n            color: #576b95; \r\n            padding: 6px 12px; \r\n            text-decoration: none; \r\n            font-size: 14px;\r\n            transition: opacity 0.2s;\r\n        }\r\n        \r\n        .login-btn:hover, .admin-btn:hover { \r\n            opacity: 0.8; \r\n        }\r\n        \r\n        .content {\r\n            padding-top: 56px;\r\n            padding-bottom: 20px;\r\n            background-color: var(--bg-primary);\r\n        }\r\n        \r\n        .moments-container {\r\n            max-width: 620px;\r\n            margin: 0 auto;\r\n        }\r\n        \r\n        .post { \r\n            background-color: var(--card-bg);\r\n            margin-bottom: 10px;\r\n            padding: 16px;\r\n            position: relative;\r\n        }\r\n        \r\n        .post-header {\r\n            display: flex;\r\n            align-items: center;\r\n            margin-bottom: 10px;\r\n        }\r\n        \r\n        .avatar {\r\n            width: 40px;\r\n            height: 40px;\r\n            border-radius: 5px;\r\n            margin-right: 12px;\r\n            background-image: url('https://imgbed.mcyzsx.top/file/avatar/1765626136745_zsxcoder.jpg');\r\n            background-size: cover;\r\n            background-position: center;\r\n            background-repeat: no-repeat;\r\n        }\r\n        \r\n        .user-info {\r\n            flex: 1;\r\n        }\r\n        \r\n        .username {\r\n            color: var(--accent-color);\r\n            font-size: 16px;\r\n            font-weight: 500;\r\n        }\r\n        \r\n        .post-date { \r\n            color: var(--text-tertiary); \r\n            font-size: 12px; \r\n            margin-top: 2px;\r\n        }\r\n        \r\n        .more-options {\r\n            width: 20px;\r\n            height: 20px;\r\n            background-size: contain;\r\n            background-repeat: no-repeat;\r\n            opacity: 0.6;\r\n            cursor: pointer;\r\n        }\r\n        \r\n        .post-content { \r\n            margin: 10px 0;\r\n            font-size: 16px;\r\n            line-height: 1.6;\r\n            white-space: pre-wrap;\r\n            word-wrap: break-word;\r\n        }\r\n        \r\n        .post-content img { \r\n            max-width: 100%; \r\n            border-radius: 6px;\r\n            margin: 10px 0;\r\n            display: block;\r\n        }\r\n        \r\n        .post-content h1, .post-content h2, .post-content h3 {\r\n            margin: 10px 0;\r\n            font-size: 16px;\r\n            font-weight: 500;\r\n            color: #333;\r\n        }\r\n        \r\n        .post-content p {\r\n            margin: 5px 0;\r\n        }\r\n        \r\n        .post-content code {\r\n            background: var(--code-bg);\r\n            padding: 2px 4px;\r\n            border-radius: 3px;\r\n            font-family: 'Monaco', 'Consolas', monospace;\r\n            font-size: 14px;\r\n        }\r\n        \r\n        .post-content pre {\r\n            background: var(--code-bg);\r\n            padding: 10px;\r\n            border-radius: 6px;\r\n            overflow-x: auto;\r\n            margin: 10px 0;\r\n            font-size: 14px;\r\n        }\r\n        \r\n        .post-content blockquote {\r\n            border-left: 3px solid var(--border-color);\r\n            padding-left: 10px;\r\n            margin: 10px 0;\r\n            color: var(--text-secondary);\r\n            font-style: italic;\r\n        }\r\n        \r\n        .post-tags {\r\n            display: flex;\r\n            flex-wrap: wrap;\r\n            gap: 5px;\r\n            margin-top: 8px;\r\n        }\r\n        \r\n        .tag { \r\n            background-color: var(--button-bg);\r\n            color: var(--text-secondary);\r\n            padding: 2px 8px;\r\n            border-radius: 10px;\r\n            font-size: 12px;\r\n            display: inline-block;\r\n        }\r\n        \r\n        .post-footer {\r\n            display: none;\r\n            margin-top: 10px;\r\n            border-top: 1px solid var(--border-color);\r\n            padding-top: 10px;\r\n        }\r\n        \r\n        .divider {\r\n            height: 10px;\r\n            background-color: var(--bg-primary);\r\n        }\r\n        \r\n        @media (max-width: 620px) {\r\n            .moments-container {\r\n                max-width: 100%;\r\n            }\r\n            \r\n            .post {\r\n                border-radius: 0;\r\n                margin-left: 0;\r\n                margin-right: 0;\r\n            }\r\n        }\r\n        \r\n        ${getThemeCSS()}\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <div class=\"header-title\">\u670B\u53CB\u5708</div>\r\n    </div>\r\n    \r\n    <div class=\"header-buttons\">\r\n        <a href=\"/admin\" class=\"admin-btn\">\u7BA1\u7406</a>\r\n        <a href=\"/admin/login\" class=\"login-btn\">\u767B\u5F55</a>\r\n    </div>\r\n    \r\n    <div class=\"content\">\r\n        <div class=\"moments-container\">\r\n            ${posts.map((post, index) => `\r\n                ${index > 0 ? '<div class=\"divider\"></div>' : ''}\r\n                <div class=\"post\">\r\n                    <div class=\"post-header\">\r\n                        <div class=\"avatar\"></div>\r\n                        <div class=\"user-info\">\r\n                            <div class=\"username\">\u949F\u795E\u79C0</div>\r\n                            <div class=\"post-date\">${post.date}</div>\r\n                        </div>\r\n                        <div class=\"more-options\"></div>\r\n                    </div>\r\n                    <div class=\"post-content\" data-markdown=\"${encodeURIComponent(post.content)}\"></div>\r\n                    <div class=\"post-tags\">\r\n                        ${post.tags.map(tag => `<span class=\"tag\">#${tag}</span>`).join('')}\r\n                    </div>\r\n                    <div class=\"post-footer\">\r\n                        <!-- \u79FB\u9664\u4E86\u8D5E\u3001\u8BC4\u8BBA\u3001\u5206\u4EAB\u6309\u94AE -->\r\n                    </div>\r\n                </div>\r\n            `).join('')}\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        // \u6E32\u67D3 Markdown \u5185\u5BB9\r\n        document.querySelectorAll('.post-content').forEach(element => {\r\n            const markdown = decodeURIComponent(element.dataset.markdown);\r\n            element.innerHTML = marked.parse(markdown);\r\n        });\r\n        \r\n        // \u521D\u59CB\u5316 more-options \u56FE\u6807\u989C\u8272\r\n        function updateMoreOptionsIcon() {\r\n            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';\r\n            const color = isDark ? '%23b0b0b0' : '%23999';\r\n            const svgUrl = 'url(data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"' + color + '\"><circle cx=\"5\" cy=\"12\" r=\"2\"/><circle cx=\"12\" cy=\"12\" r=\"2\"/><circle cx=\"19\" cy=\"12\" r=\"2\"/></svg>');\r\n            document.querySelectorAll('.more-options').forEach(el => {\r\n                el.style.backgroundImage = svgUrl;\r\n            });\r\n        }\r\n        \r\n        // \u76D1\u542C\u4E3B\u9898\u5207\u6362\u4E8B\u4EF6\r\n        const observer = new MutationObserver(updateMoreOptionsIcon);\r\n        observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });\r\n        \r\n        // \u521D\u59CB\u8BBE\u7F6E\u56FE\u6807\r\n        updateMoreOptionsIcon();\r\n    </script>\r\n    \r\n    ${getThemeToggleScript()}\r\n    \r\n    <!-- \u4E3B\u9898\u5207\u6362\u6309\u94AE -->\r\n    ${getThemeToggleHTML()}\r\n</body>\r\n</html>`;\r\n}\r\n", "// Neon PostgreSQL \u9002\u914D\u5C42\nexport class NeonDatabase {\n  constructor(env) {\n    this.env = env;\n    this.connectionString = env.DATABASE_URL;\n    this.pool = null;\n  }\n\n  async initialize() {\n    try {\n      console.log('Initializing Neon PostgreSQL connection...');\n      \n      // \u52A8\u6001\u5BFC\u5165 pg \u5E93\n      const { Pool } = await import('pg');\n      \n      this.pool = new Pool({\n        connectionString: this.connectionString,\n        ssl: { rejectUnauthorized: false },\n        max: 20, // \u8FDE\u63A5\u6C60\u5927\u5C0F\n        idleTimeoutMillis: 30000,\n        connectionTimeoutMillis: 10000,\n      });\n\n      // \u6D4B\u8BD5\u8FDE\u63A5\n      const client = await this.pool.connect();\n      await client.query('SELECT 1');\n      client.release();\n      \n      console.log('Neon PostgreSQL initialized successfully');\n      \n      // \u521D\u59CB\u5316\u6570\u636E\u5E93\u8868\u7ED3\u6784\n      await this.initializeTables();\n    } catch (error) {\n      console.error('Failed to initialize Neon database:', error);\n      throw error;\n    }\n  }\n\n  async initializeTables() {\n    const client = await this.pool.connect();\n    try {\n      // \u521B\u5EFA\u6587\u7AE0\u8868\n      await client.query(`\n        CREATE TABLE IF NOT EXISTS posts (\n          id VARCHAR(50) PRIMARY KEY,\n          title VARCHAR(200),\n          content TEXT,\n          tags TEXT[],\n          date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n          updated_at TIMESTAMP WITH TIME ZONE,\n          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n        )\n      `);\n\n      // \u521B\u5EFA\u4F1A\u8BDD\u8868\n      await client.query(`\n        CREATE TABLE IF NOT EXISTS sessions (\n          token VARCHAR(100) PRIMARY KEY,\n          username VARCHAR(50) NOT NULL,\n          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n          last_accessed TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n          expires_at TIMESTAMP WITH TIME ZONE,\n          INDEX idx_expires_at (expires_at),\n          INDEX idx_username (username)\n        )\n      `);\n\n      // \u521B\u5EFA\u7D22\u5F15\u4F18\u5316\u67E5\u8BE2\u6027\u80FD\n      await client.query(`\n        CREATE INDEX IF NOT EXISTS idx_posts_date ON posts (date DESC)\n      `);\n\n      console.log('Database tables initialized');\n    } catch (error) {\n      console.error('Error initializing tables:', error);\n      throw error;\n    } finally {\n      client.release();\n    }\n  }\n\n  // \u6587\u7AE0\u76F8\u5173\u64CD\u4F5C\n  async getAllPosts() {\n    const startTime = Date.now();\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        SELECT id, title, content, tags, date, updated_at as \"updatedAt\"\n        FROM posts \n        ORDER BY date DESC\n      `);\n      \n      const duration = Date.now() - startTime;\n      console.log(`Fetched ${result.rows.length} posts from Neon in ${duration}ms`);\n      \n      return result.rows.map(row => ({\n        ...row,\n        tags: row.tags || []\n      }));\n    } catch (error) {\n      console.error('Error getting all posts:', error);\n      return [];\n    } finally {\n      client.release();\n    }\n  }\n\n  async getPost(postId) {\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        SELECT id, title, content, tags, date, updated_at as \"updatedAt\"\n        FROM posts \n        WHERE id = $1\n      `, [postId]);\n      \n      if (result.rows.length === 0) return null;\n      \n      return {\n        ...result.rows[0],\n        tags: result.rows[0].tags || []\n      };\n    } catch (error) {\n      console.error('Error getting post:', error);\n      return null;\n    } finally {\n      client.release();\n    }\n  }\n\n  async createPost(postData) {\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        INSERT INTO posts (id, title, content, tags, date)\n        VALUES ($1, $2, $3, $4)\n        RETURNING *\n      `, [postData.id, postData.title || '', postData.content, postData.tags || [], postData.date]);\n      \n      console.log('Created post:', result.rows[0].id);\n      return result.rows[0];\n    } catch (error) {\n      console.error('Error creating post:', error);\n      throw error;\n    } finally {\n      client.release();\n    }\n  }\n\n  async updatePost(postId, updateData) {\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        UPDATE posts \n        SET title = $1, content = $2, tags = $3, updated_at = NOW()\n        WHERE id = $4\n        RETURNING *\n      `, [updateData.title || '', updateData.content, updateData.tags || [], postId]);\n      \n      if (result.rows.length === 0) return null;\n      \n      console.log('Updated post:', postId);\n      return {\n        ...result.rows[0],\n        tags: result.rows[0].tags || []\n      };\n    } catch (error) {\n      console.error('Error updating post:', error);\n      throw error;\n    } finally {\n      client.release();\n    }\n  }\n\n  async deletePost(postId) {\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        DELETE FROM posts WHERE id = $1\n        RETURNING id\n      `, [postId]);\n      \n      const deleted = result.rows.length > 0;\n      console.log(`${deleted ? 'Deleted' : 'Not found'} post: ${postId}`);\n      return deleted;\n    } catch (error) {\n      console.error('Error deleting post:', error);\n      throw error;\n    } finally {\n      client.release();\n    }\n  }\n\n  // \u4F1A\u8BDD\u76F8\u5173\u64CD\u4F5C\n  async createSession(token, username, expiresIn = 604800) {\n    const client = await this.pool.connect();\n    try {\n      const expiresAt = new Date(Date.now() + expiresIn * 1000);\n      \n      await client.query(`\n        INSERT INTO sessions (token, username, expires_at)\n        VALUES ($1, $2, $3)\n      `, [token, username, expiresAt]);\n      \n      console.log('Created session for user:', username);\n      return true;\n    } catch (error) {\n      console.error('Error creating session:', error);\n      return false;\n    } finally {\n      client.release();\n    }\n  }\n\n  async getSession(token) {\n    const client = await this.pool.connect();\n    try {\n      // \u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\n      await this.cleanupExpiredSessions(client);\n      \n      const result = await client.query(`\n        SELECT token, username, created_at, last_accessed, expires_at\n        FROM sessions \n        WHERE token = $1 AND expires_at > NOW()\n      `, [token]);\n      \n      if (result.rows.length === 0) return null;\n      \n      const session = result.rows[0];\n      \n      // \u66F4\u65B0\u6700\u540E\u8BBF\u95EE\u65F6\u95F4\uFF08\u5F02\u6B65\uFF0C\u4E0D\u963B\u585E\u8BF7\u6C42\uFF09\n      client.query(`\n        UPDATE sessions \n        SET last_accessed = NOW() \n        WHERE token = $1\n      `, [token]).catch(err => console.error('Error updating last accessed:', err));\n      \n      return {\n        username: session.username,\n        createdAt: session.created_at,\n        lastAccessed: session.last_accessed\n      };\n    } catch (error) {\n      console.error('Error getting session:', error);\n      return null;\n    } finally {\n      client.release();\n    }\n  }\n\n  async updateSession(token, updateData) {\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        UPDATE sessions \n        SET last_accessed = NOW()\n        WHERE token = $1\n        RETURNING *\n      `, [token]);\n      \n      return result.rows.length > 0;\n    } catch (error) {\n      console.error('Error updating session:', error);\n      return false;\n    } finally {\n      client.release();\n    }\n  }\n\n  async deleteSession(token) {\n    const client = await this.pool.connect();\n    try {\n      const result = await client.query(`\n        DELETE FROM sessions WHERE token = $1\n        RETURNING token\n      `, [token]);\n      \n      const deleted = result.rows.length > 0;\n      console.log(`${deleted ? 'Deleted' : 'Not found'} session: ${token.substring(0, 8)}...`);\n      return deleted;\n    } catch (error) {\n      console.error('Error deleting session:', error);\n      return false;\n    } finally {\n      client.release();\n    }\n  }\n\n  async cleanupExpiredSessions(client = null) {\n    const shouldReleaseClient = !client;\n    \n    if (shouldReleaseClient) {\n      client = await this.pool.connect();\n    }\n    \n    try {\n      const result = await client.query(`\n        DELETE FROM sessions \n        WHERE expires_at <= NOW()\n        RETURNING token\n      `);\n      \n      if (result.rows.length > 0) {\n        console.log(`Cleaned up ${result.rows.length} expired sessions`);\n      }\n      \n      return result.rows.length;\n    } catch (error) {\n      console.error('Error cleaning up sessions:', error);\n      return 0;\n    } finally {\n      if (shouldReleaseClient) {\n        client.release();\n      }\n    }\n  }\n\n  // \u6570\u636E\u5E93\u7EDF\u8BA1\u548C\u76D1\u63A7\n  async getStats() {\n    const client = await this.pool.connect();\n    try {\n      const postsResult = await client.query(`\n        SELECT COUNT(*) as total_posts FROM posts\n      `);\n      \n      const sessionsResult = await client.query(`\n        SELECT COUNT(*) as active_sessions \n        FROM sessions \n        WHERE expires_at > NOW()\n      `);\n      \n      const expiredResult = await client.query(`\n        SELECT COUNT(*) as expired_sessions \n        FROM sessions \n        WHERE expires_at <= NOW()\n      `);\n      \n      return {\n        posts: {\n          total: parseInt(postsResult.rows[0].total_posts)\n        },\n        sessions: {\n          active: parseInt(sessionsResult.rows[0].active_sessions),\n          expired: parseInt(expiredResult.rows[0].expired_sessions)\n        },\n        database: {\n          connected: this.pool.totalCount || 0,\n          idle: this.pool.idleCount || 0,\n          waiting: this.pool.waitingCount || 0\n        }\n      };\n    } catch (error) {\n      console.error('Error getting stats:', error);\n      return null;\n    } finally {\n      client.release();\n    }\n  }\n\n  // \u5173\u95ED\u8FDE\u63A5\u6C60\n  async close() {\n    if (this.pool) {\n      await this.pool.end();\n      console.log('Neon PostgreSQL connection closed');\n    }\n  }\n\n  // \u5065\u5EB7\u68C0\u67E5\n  async healthCheck() {\n    try {\n      const client = await this.pool.connect();\n      const result = await client.query('SELECT 1 as health');\n      client.release();\n      \n      return {\n        status: 'healthy',\n        database: 'neon_postgresql',\n        timestamp: new Date().toISOString(),\n        connected: this.pool.totalCount || 0\n      };\n    } catch (error) {\n      return {\n        status: 'unhealthy',\n        error: error.message,\n        timestamp: new Date().toISOString()\n      };\n    }\n  }\n}\n\n// \u6570\u636E\u5E93\u9002\u914D\u5668\u5DE5\u5382\nexport function createDatabaseAdapter(env) {\n  // \u6839\u636E\u73AF\u5883\u53D8\u91CF\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B\n  const dbType = env.DATABASE_TYPE || 'kv';\n  \n  switch (dbType.toLowerCase()) {\n    case 'neon':\n    case 'postgresql':\n      console.log('Using Neon PostgreSQL adapter');\n      return new NeonDatabase(env);\n      \n    case 'kv':\n    default:\n      console.log('Using KV fallback adapter');\n      return null; // \u5C06\u4F7F\u7528\u73B0\u6709\u7684 KV \u903B\u8F91\n  }\n}\n\n// \u6570\u636E\u5E93\u64CD\u4F5C\u5305\u88C5\u5668\nexport class DatabaseWrapper {\n  constructor(env) {\n    this.adapter = createDatabaseAdapter(env);\n    this.env = env;\n  }\n\n  async initialize() {\n    if (this.adapter) {\n      await this.adapter.initialize();\n    }\n  }\n\n  // \u81EA\u52A8\u8DEF\u7531\u5230\u5408\u9002\u7684\u6570\u636E\u5E93\n  async getAllPosts() {\n    if (this.adapter) {\n      return await this.adapter.getAllPosts();\n    }\n    // \u56DE\u9000\u5230 KV\n    const { getAllPosts } = await import('./utils.js');\n    return await getAllPosts(this.env.POSTS_KV);\n  }\n\n  async getPost(postId) {\n    if (this.adapter) {\n      return await this.adapter.getPost(postId);\n    }\n    // \u56DE\u9000\u5230 KV\n    const postData = await this.env.POSTS_KV.get(`post:${postId}`, 'json');\n    return postData;\n  }\n\n  async createPost(postData) {\n    if (this.adapter) {\n      return await this.adapter.createPost(postData);\n    }\n    // \u56DE\u9000\u5230 KV\n    await this.env.POSTS_KV.put(`post:${postData.id}`, JSON.stringify(postData));\n    return postData;\n  }\n\n  async updatePost(postId, updateData) {\n    if (this.adapter) {\n      return await this.adapter.updatePost(postId, updateData);\n    }\n    // \u56DE\u9000\u5230 KV\n    const existingPost = await this.env.POSTS_KV.get(`post:${postId}`, 'json');\n    if (!existingPost) return null;\n    \n    const updatedPost = { ...existingPost, ...updateData, updatedAt: new Date().toISOString() };\n    await this.env.POSTS_KV.put(`post:${postId}`, JSON.stringify(updatedPost));\n    return updatedPost;\n  }\n\n  async deletePost(postId) {\n    if (this.adapter) {\n      return await this.adapter.deletePost(postId);\n    }\n    // \u56DE\u9000\u5230 KV\n    await this.env.POSTS_KV.delete(`post:${postId}`);\n    return true;\n  }\n\n  async getSession(token) {\n    if (this.adapter) {\n      return await this.adapter.getSession(token);\n    }\n    // \u56DE\u9000\u5230 KV\n    const { verifySession } = await import('./utils.js');\n    const result = await verifySession(\n      { headers: { get: () => `session=${token}` } },\n      this.env\n    );\n    return result.valid ? { username: result.username } : null;\n  }\n\n  async getStats() {\n    if (this.adapter) {\n      return await this.adapter.getStats();\n    }\n    \n    // KV \u7EDF\u8BA1\n    try {\n      const list = await this.env.POSTS_KV.list({ prefix: 'post:' });\n      const sessionList = await this.env.POSTS_KV.list({ prefix: 'session:' });\n      \n      return {\n        posts: { total: list.keys.length },\n        sessions: { \n          active: sessionList.keys.length,\n          expired: 'unknown'\n        },\n        database: { type: 'cloudflare_kv' }\n      };\n    } catch (error) {\n      console.error('Error getting KV stats:', error);\n      return null;\n    }\n  }\n}", "import { handleAuth } from './auth.js';\r\nimport { handleAPI } from './api.js';\r\nimport { handleAdmin } from './admin.js';\r\nimport { handlePublic } from './public.js';\r\nimport { DatabaseWrapper } from './database.js';\r\n\r\n// \u5168\u5C40\u6570\u636E\u5E93\u5B9E\u4F8B\uFF08\u907F\u514D\u91CD\u590D\u521D\u59CB\u5316\uFF09\r\nlet dbWrapper = null;\r\n\r\n// \u521D\u59CB\u5316\u6570\u636E\u5E93\u8FDE\u63A5\r\nasync function initializeDatabase(env) {\r\n  if (!dbWrapper) {\r\n    dbWrapper = new DatabaseWrapper(env);\r\n    await dbWrapper.initialize();\r\n  }\r\n}\r\n\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    const url = new URL(request.url);\r\n    const path = url.pathname;\r\n\r\n    // \u6DFB\u52A0 CORS \u5934\uFF0C\u786E\u4FDD\u8DE8\u57DF\u8BF7\u6C42\u6B63\u5E38\u5DE5\u4F5C\r\n    const corsHeaders = {\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    };\r\n    \r\n    // \u5904\u7406 OPTIONS \u8BF7\u6C42\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { headers: corsHeaders });\r\n    }\r\n    \r\n    try {\r\n      // \u521D\u59CB\u5316\u6570\u636E\u5E93\uFF08\u5982\u679C\u5C1A\u672A\u521D\u59CB\u5316\uFF09\r\n      await initializeDatabase(env);\r\n      \r\n      // \u8DEF\u7531\u5904\u7406\r\n      if (path.startsWith('/auth')) {\r\n        return handleAuth(request, env, dbWrapper);\r\n      }\r\n      \r\n      if (path.startsWith('/api')) {\r\n        return handleAPI(request, env, dbWrapper);\r\n      }\r\n      \r\n      if (path.startsWith('/admin')) {\r\n        return handleAdmin(request, env, dbWrapper);\r\n      }\r\n      \r\n      return handlePublic(request, env, dbWrapper);\r\n    } catch (error) {\r\n      console.error('Error handling request:', error);\r\n      return new Response(`\u670D\u52A1\u5668\u9519\u8BEF: ${error.message}`, { \r\n        status: 500,\r\n        headers: corsHeaders\r\n      });\r\n    }\r\n  }\r\n};"],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": ["dbWrapper", "error", "dbWrapper", "request", "env", "dbWrapper", "getAllPosts", "verifySession", "dbWrapper"]
}
